# Docker Container Metrics Exporter

## Описание
Это приложение на Go, которое мониторит Docker-контейнеры и экспортирует их метрики в формате Prometheus. Программа отслеживает состояние контейнеров (запуск, остановка, перезапуск) и собирает информацию о времени их запуска.
![image](https://github.com/user-attachments/assets/88bac4fb-e5ac-4660-88b1-fba4e6139bc0)


## Функциональность

- **Мониторинг контейнеров**: Отслеживает все запущенные Docker-контейнеры
- **Экспорт метрик**: Предоставляет метрики в формате Prometheus
- **Обработка событий Docker**: Реагирует на события контейнеров (запуск, остановка, перезапуск)
- **Автоматическая очистка**: Удаляет метрики для неактивных контейнеров
- **Отказоустойчивость**: Перезапускает мониторинг при возникновении ошибок

## Экспортируемые метрики

- `start_time_seconds_container` - время запуска контейнера в формате Unix timestamp
- `server_hostname` - имя хоста Docker-сервера

Метрики предоставляются с подробными лейблами, включая:
- Идентификатор контейнера
- Имя контейнера
- Образ контейнера
- Метки Docker Compose (project, service, version и т.д.)

## Использование

### Переменные окружения

- `EXPORTER_PORT` - порт для HTTP-сервера (по умолчанию 8000)

### Запуск приложения

```bash
go run main.go
```

Или с использованием Docker Compose:

```bash
# Сборка образа
docker build -t decustom_go:0.0.2 .

# Запуск с помощью Docker Compose
docker compose up -d
```

### Доступ к метрикам

Метрики доступны по адресу `http://localhost:8000/metrics`

## Архитектура

Приложение состоит из нескольких ключевых компонентов:

1. **Docker Client** - для взаимодействия с Docker API
2. **Реестр контейнеров** - для отслеживания состояния контейнеров
3. **Мониторинг событий** - для обработки событий Docker в реальном времени
4. **Экспортер метрик** - для предоставления метрик в формате Prometheus
5. **Периодические обновления** - для регулярного обновления метрик

## Требования

- Go 1.13 или выше
- Docker
- Docker Compose
- Доступ к Docker API (сокет Docker)

## Особенности работы

- Программа обрабатывает события Docker в реальном времени
- Метрики обновляются каждые 15 секунд
- Контейнеры, не наблюдаемые в течение 30 секунд, считаются устаревшими, и их метрики удаляются
- При перезапуске контейнера его старые метрики удаляются, и создаются новые 
